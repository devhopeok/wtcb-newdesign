<!--
  Generated template for the MaintenanceTrackerPage page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header>

    <ion-navbar>
        <ion-title>ESTADO DE SU SOLICITUD</ion-title>
    </ion-navbar>

</ion-header>


<ion-content padding>

    <ion-list>
        <ion-list-header class="header-style">
            FASE
        </ion-list-header>
    </ion-list>

    <div class="wrapper">
        <ul class="StepProgress">
            <li class="StepProgress-item" [ngClass]="{'is-done': request.step > 1, 'current': request.step == 1}">
                <strong class="subheader-style">FASE 1 - Solicitud</strong>
                <ion-list no-lines *ngIf="(authUser.level == '3.1' || authUser.level == '3.2') && request.step == 1">
                    <!-- <ion-item>
                        <ion-icon class="icon-style" style="padding-left:0;" name="md-calendar"></ion-icon>
                        <ion-note class="icon-style">{{request.created_at | amLocale:'en' | amDateFormat:'MMM Do YYYY'}}</ion-note>
                        -
                        <ion-icon class="icon-style" name="ios-clock-outline"></ion-icon>
                        <ion-note class="icon-style">{{request.created_at | amLocale:'en' | amDateFormat:'h:mm a'}}</ion-note>
                    </ion-item> -->
                    
                    <ion-item>
                        <ion-toggle color="custom" checked="true" disabled="true"></ion-toggle>
                        <ion-label class="icon-style">
                            Request Sent
                        </ion-label>
                    </ion-item>
                </ion-list>

                <ion-list no-lines *ngIf="(authUser.level == 7 || authUser.level == 8) && request.step >= 1">
                    <!-- <ion-item>
                        <ion-icon class="icon-style" style="padding-left:0;" name="md-calendar"></ion-icon>
                        <ion-note class="icon-style">{{request.created_at | amLocale:'en' | amDateFormat:'MMM Do YYYY'}}</ion-note>
                        -
                        <ion-icon class="icon-style" name="ios-clock-outline"></ion-icon>
                        <ion-note class="icon-style">{{request.created_at | amLocale:'en' | amDateFormat:'h:mm a'}}</ion-note>
                    </ion-item> -->
                    <ion-item>
                        <ion-toggle color="custom" [(ngModel)]="showQuote"></ion-toggle>
                        <ion-label>
                            CARGAR COTIZACIÓN
                        </ion-label>
                    </ion-item>
                    <ion-item *ngIf="showQuote">
                        <div>
                            <textarea placeholder="Your comments" class="textarea-style" [(ngModel)]="quote"></textarea>
                        </div>
                    </ion-item>
                </ion-list>

                <button ion-button block (click)="goToStep2()" class="main-btn" style="margin-top:2vw;" *ngIf="(authUser.level == 7 || authUser.level == 8) && request.step >= 1">
                    ENVIAR COTIZACIÓN
                </button>

            </li>
            <li class="StepProgress-item" [ngClass]="{'is-done': request.step > 2, 'current': request.step == 2}">
                <strong class="subheader-style">FASE 2 - Cotización</strong>
                <ion-list no-lines *ngIf="(authUser.level == '3.1' || authUser.level == '3.2') && request.step == 2">
                    <!-- <ion-item>
                        <ion-icon class="icon-style" style="padding-left:0;" name="md-calendar"></ion-icon>
                        <ion-note class="icon-style">{{request.created_at | amLocale:'en' | amDateFormat:'MMM Do YYYY'}}</ion-note>
                        -
                        <ion-icon class="icon-style" name="ios-clock-outline"></ion-icon>
                        <ion-note class="icon-style">{{request.created_at | amLocale:'en' | amDateFormat:'h:mm a'}}</ion-note>
                    </ion-item> -->
                    
                    
                    <p class="icon-style" style="word-wrap: break-word;">You would get email from Admin about Quote. Please check your email. </p>
                    
                    <p class="icon-style" *ngIf = "quoteAccept" style="word-wrap: break-word;">Quote Accepted</p>
                    <!-- <ion-item>
                        <ion-toggle [(ngModel)]="quoteAccept"></ion-toggle>
                        <ion-label>
                            Accept Quote
                        </ion-label>
                    </ion-item> -->
                </ion-list>

                <button ion-button block (click)="acceptQuote()" class="main-btn" style="margin-top:2vw;" *ngIf="request.step == 2 && (authUser.level == '3.1' || authUser.level == '3.2') && !quoteAccept">
                    Accept Quote
                </button>

                <ion-list no-lines *ngIf="(authUser.level == 7 || authUser.level == 8) && request.step >= 2">
                    <!-- <ion-item>
                        <ion-icon class="icon-style" style="padding-left:0;" name="md-calendar"></ion-icon>
                        <ion-note class="icon-style">{{request.created_at | amLocale:'en' | amDateFormat:'MMM Do YYYY'}}</ion-note>
                        -
                        <ion-icon class="icon-style" name="ios-clock-outline"></ion-icon>
                        <ion-note class="icon-style">{{request.created_at | amLocale:'en' | amDateFormat:'h:mm a'}}</ion-note>
                    </ion-item> -->

                    <ion-item>
                        <ion-toggle color="custom" [(ngModel)]="quoteAccept" disabled="true"></ion-toggle>
                        <ion-label>
                            COTIZACIÓN ACEPTADA
                        </ion-label>
                    </ion-item>
                    <ion-item *ngIf="quoteAccept">
                        <ion-toggle color="custom" [(ngModel)]="showSchedule"></ion-toggle>
                        <ion-label>
                            Schedule Appointment
                        </ion-label>
                    </ion-item>
                </ion-list>

                <ion-list no-lines *ngIf="showSchedule">
                    <ion-item>
                        <ion-label>Date</ion-label>
                        <ion-datetime displayFormat="MMM DD YYYY" [(ngModel)]="technician_date"></ion-datetime>
                    </ion-item>
                    <ion-item>
                        <ion-label>Time</ion-label>
                        <ion-datetime displayFormat="h:mm A" pickerFormat="h mm A" [(ngModel)]="technician_time"></ion-datetime>
                    </ion-item>
                    <ion-item>
                        <ion-label>Technician Name</ion-label>
                        <ion-input type="text" [(ngModel)]="technician_name"></ion-input>
                    </ion-item>
                    <ion-item>
                        <ion-label>Company Name</ion-label>
                        <ion-input type="text" [(ngModel)]="technician_company"></ion-input>
                    </ion-item>
                    <ion-item>
                        <ion-label>Telephone</ion-label>
                        <ion-input type="text" [(ngModel)]="technician_phone"></ion-input>
                    </ion-item>
                </ion-list>

                <button ion-button block class="main-btn" style="margin-top:2vw;" (click)="goToStep3()"
                        *ngIf="(authUser.level == 7 || authUser.level == 8) && quoteAccept">
                    PROGRAMAR VISITA
                </button>
            </li>
            <li class="StepProgress-item" [ngClass]="{'is-done': request.step > 3, 'current': request.step == 3}">
                <strong class="subheader-style">FASE 3 - Inicio & Finalización trabajo</strong>

                <ion-list no-lines *ngIf="(authUser.level == '3.1' || authUser.level == '3.2') && request.step == 3">
                    <!-- <ion-item>
                        <ion-icon class="icon-style" style="padding-left:0;" name="md-calendar"></ion-icon>
                        <ion-note class="icon-style">{{request.created_at | amLocale:'en' | amDateFormat:'MMM Do YYYY'}}</ion-note>
                        -
                        <ion-icon class="icon-style" name="ios-clock-outline"></ion-icon>
                        <ion-note class="icon-style">{{request.created_at | amLocale:'en' | amDateFormat:'h:mm a'}}</ion-note>
                    </ion-item> -->
                    <ion-item>
                        <ion-label>Date</ion-label>
                        <ion-input type="text" [(ngModel)]="requestDetail.technician_info.date" [readonly]="true"></ion-input>
                    </ion-item>
                    <ion-item>
                        <ion-label>Technician Time</ion-label>
                        <ion-input type="text" [(ngModel)]="requestDetail.technician_info.time" [readonly]="true"></ion-input>
                    </ion-item>
                    <ion-item>
                        <ion-label>Technician Name</ion-label>
                        <ion-input type="text" [(ngModel)]="requestDetail.technician_info.name" [readonly]="true"></ion-input>
                    </ion-item>
                    <ion-item>
                        <ion-label>Company Name</ion-label>
                        <ion-input type="text" [(ngModel)]="requestDetail.technician_info.company" [readonly]="true"></ion-input>
                    </ion-item>
                    <ion-item>
                        <ion-label>Telephone</ion-label>
                        <ion-input type="text" [(ngModel)]="requestDetail.technician_info.phone" [readonly]="true"></ion-input>
                    </ion-item>

                    <p class="icon-style" *ngIf = "scheduleAccept" style="word-wrap: break-word;">Schedule Accepted</p>
                    <!-- <ion-item>
                        <ion-toggle [(ngModel)]="scheduleAccept"></ion-toggle>
                        <ion-label>
                            Accept Schedule
                        </ion-label>
                    </ion-item> -->
                </ion-list>

                <button ion-button block (click)="acceptSchedule()" class="main-btn" style="margin-top:2vw;" *ngIf="request.step == 3 && (authUser.level == '3.1' || authUser.level == '3.2') && !scheduleAccept">
                    Accept Schedule
                </button>

                <ion-list no-lines *ngIf="(authUser.level == 7 || authUser.level == 8) && request.step >=3">
                    <!-- <ion-item>
                        <ion-icon class="icon-style" style="padding-left:0;" name="md-calendar"></ion-icon>
                        <ion-note class="icon-style">{{request.created_at | amLocale:'en' | amDateFormat:'MMM Do YYYY'}}</ion-note>
                        -
                        <ion-icon class="icon-style" name="ios-clock-outline"></ion-icon>
                        <ion-note class="icon-style">{{request.created_at | amLocale:'en' | amDateFormat:'h:mm a'}}</ion-note>
                    </ion-item> -->
                    
                    <ion-item>
                        <ion-toggle color="custom" [(ngModel)]="scheduleAccept" disabled="true"></ion-toggle>
                        <ion-label>
                            PROGRAMACIÓN ACEPTADA
                        </ion-label>
                    </ion-item>
                    <!-- <ion-item *ngIf="scheduleAccept">
                        <ion-label>Job Complete</ion-label>
                        <ion-toggle color="custom" [(ngModel)]="is_completed"></ion-toggle>
                    </ion-item> -->
                </ion-list>

                <button ion-button block class="main-btn" (click)="goToStep4()"
                        *ngIf="(authUser.level == 7 || authUser.level == 8) && scheduleAccept">
                    Job Complete
                </button>
            </li>
            <li class="StepProgress-item" [ngClass]="{'is-done': request.step > 4, 'current': request.step == 4}">
                <strong class="subheader-style">FASE 4 - Facturación</strong>

                <ion-list no-lines *ngIf="(authUser.level == '3.1' || authUser.level == '3.2') && request.step == 4">
                    <!-- <ion-item>
                        <ion-icon class="icon-style" style="padding-left:0;" name="md-calendar"></ion-icon>
                        <ion-note class="icon-style">{{request.created_at | amLocale:'en' | amDateFormat:'MMM Do YYYY'}}</ion-note>
                        -
                        <ion-icon class="icon-style" name="ios-clock-outline"></ion-icon>
                        <ion-note class="icon-style">{{request.created_at | amLocale:'en' | amDateFormat:'h:mm a'}}</ion-note>
                    </ion-item> -->
                    <ion-item>
                        <ion-toggle color="custom" [(ngModel)]="requestDetail.is_completed" disabled="true"></ion-toggle>
                        <ion-label>
                            Job Complete
                        </ion-label>
                    </ion-item>
                </ion-list>

                <button ion-button block icon-left class="main-btn" *ngIf="request.step == 4 && (authUser.level == '3.1' || authUser.level == '3.2')" (click)="payInvoice()">
                    <ion-icon ios="ios-card" md="md-card"></ion-icon>
                    Pay Invoice
                </button>

                <ion-list no-lines *ngIf="(authUser.level == 7 || authUser.level == 8) && request.step >= 4">
                    <!-- <ion-item>
                        <ion-icon ios="ios-calendar" md="md-calendar"></ion-icon>
                        FECHA DE SOLICITUD
                        <ion-note item-end>{{request.created_at | amLocale:'en' | amDateFormat:'MMM Do YYYY, h:mm:ss a'}}</ion-note>
                    </ion-item>
                    <ion-item>
                        {{office.buildingName}} | {{office.floorName}} | {{office.name}}
                    </ion-item> -->
                    <ion-item>
                        <ion-icon class="icon-style" ios="ios-calendar" md="md-calendar"></ion-icon>
                        FACTURA
                        <ion-note class="icon-style" *ngIf="!is_paid" item-end>EN ESPERA</ion-note>
                        <ion-note class="icon-style" *ngIf="is_paid" item-end>PAID</ion-note>
                    </ion-item>
                </ion-list>

                <!-- <ion-card *ngIf="requestDetail.status3 && (authUser.level == 7 || authUser.level == 8)  && request.step == 4">
                    <img src="{{requestDetail.invoice}}"/>
                </ion-card> -->

                <button ion-button block class="main-btn" icon-left *ngIf="is_paid && (authUser.level == 7 || authUser.level == 8)" (click)="paidInvoice()">
                    <ion-icon ios="ios-card" md="md-card"></ion-icon>
                    FACTURA PAGADA
                </button>
            </li>
            <li class="StepProgress-item" [ngClass]="{'is-done': request.step > 5, 'current': request.step == 5}">
                <strong class="subheader-style">FASE 5 -  Pago</strong>

                <!-- <ion-list no-lines *ngIf="(authUser.level == '3.1' || authUser.level == '3.2') && request.step == 5">
                    <ion-item>
                        <ion-icon ios="ios-calendar" md="md-calendar"></ion-icon>
                        Job Paid
                        <ion-note item-end (click)="viewInvoice()">View</ion-note>
                    </ion-item>
                </ion-list>

                <ion-card *ngIf="(authUser.level == '3.1' || authUser.level == '3.2') && request.step == 5 && showInvoice">
                    <img src="{{requestDetail.invoice}}"/>
                </ion-card> -->

                <ion-list no-lines *ngIf="(authUser.level == '3.1' || authUser.level == '3.2') && request.step == 5">
                    <ion-item>
                        <ion-label class="icon-style">Please rate work</ion-label>
                        <ion-select [(ngModel)]="rate">
                            <ion-option value="5">5 stars</ion-option>
                            <ion-option value="4">4 stars</ion-option>
                            <ion-option value="3">3 stars</ion-option>
                            <ion-option value="2">2 stars</ion-option>
                            <ion-option value="1">1 stars</ion-option>
                            <ion-option value="0">0 stars</ion-option>
                        </ion-select>
                    </ion-item>
                    <ion-item>
                        <div>
                            <textarea placeholder="Your comments" class="textarea-style" [(ngModel)]="comment"></textarea>
                        </div>
                    </ion-item>
                </ion-list>

                <button ion-button block icon-left class="main-btn" style="margin-top:2vw;" *ngIf="request.step == 5 && (authUser.level == '3.1' || authUser.level == '3.2')" (click)="leaveReview()">
                    <ion-icon ios="ios-star" md="md-star"></ion-icon>
                    Leave Review
                </button>


                <ion-list no-lines *ngIf="(authUser.level == 7 || authUser.level == 8) && request.step >= 5">
                    <ion-item *ngIf="requestDetail.status5 == 0">
                        <ion-icon class="icon-style" ios="ios-calendar" md="md-calendar"></ion-icon>
                        Complete
                        <ion-note class="icon-style" item-end>Pending Review</ion-note>
                    </ion-item>
                    <ion-item *ngIf="requestDetail.status5 == 1">
                        Rate
                        <ion-note class="icon-style" item-end>{{requestDetail.star}} stars</ion-note>
                    </ion-item>
                    <ion-item *ngIf="requestDetail.status5 == 1">
                        {{requestDetail.comment}}
                    </ion-item>
                </ion-list>

                <button ion-button block icon-left class="main-btn" *ngIf="requestDetail.status5 == 1 && ((authUser.level == 7 || authUser.level == 8))" (click)="archiveRequest()">
                    <ion-icon ios="ios-cloud-download" md="md-cloud-download"></ion-icon>
                    Archive MAINT. REQ.
                </button>
            </li>
        </ul>
    </div>

    <ion-list style="margin-top: 20px;">
        <ion-list-header>
            INFORMACIÓN CLIENTE
        </ion-list-header>
        <ion-item>
            <ion-avatar item-start>
                <img src="assets/imgs/working-icon.png">
            </ion-avatar>
            <h2>{{office.company}}</h2>
            <p>{{office.name}}</p>
        </ion-item>
        <ion-item>
            <ion-icon ios="ios-calendar" md="md-calendar"></ion-icon>
            FECHA DE SOLICITUD
            <ion-note item-end *ngIf="authUser.level != 4">{{request.created_at | amLocale:'en' | amDateFormat:'MMM Do YYYY, h:mm:ss a'}}</ion-note>
        </ion-item>
    </ion-list>

    <ion-list>
        <ion-list-header>
            SOLICITADO POR
        </ion-list-header>
        <ion-item>
            <ion-icon ios="ios-person" md="md-person"></ion-icon>
            {{user.first_name + ' ' + user.last_name}}
        </ion-item>
        <ion-item>
            <ion-toggle [(ngModel)]="viewRequest"></ion-toggle>
            <ion-label>
                VER DETALES DE LA SOLICITUD
            </ion-label>
        </ion-item>
    </ion-list>

    <ion-card *ngIf="viewRequest">
        <ion-card-content>
            <p>{{request.comment}}</p>
        </ion-card-content>

        <ion-slides pager="true" *ngIf="request.photos && request.photos.length > 0">
            <ion-slide *ngFor="let item of request.photos;">
                <img src="{{item}}"/>
            </ion-slide>
        </ion-slides>
    </ion-card>
</ion-content>
